<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TSI Ratings Login - Secure Access</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        :root {
            --tsi-primary: #006A67; /* Primary Dark Teal Color */
            --background: #f4fbf9; /* Light, clean background */
            --border-color: #D1D5DB; /* Light gray border */
            --focus-color: #008080; /* A slightly brighter teal for focus */
        }

        body {
            background-color: var(--background);
            font-family: ui-sans-serif, system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .login-card {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            max-width: 500px;
        }

        .primary-text { color: var(--tsi-primary); }

        .input-style {
            border-color: var(--border-color);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .input-style:focus {
            outline: none;
            border-color: var(--tsi-primary);
            box-shadow: 0 0 0 1px var(--tsi-primary);
        }

        .otp-input {
            width: 3rem;
            height: 3rem;
            text-align: center;
            font-size: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .otp-input:focus {
            outline: none;
            border-color: var(--tsi-primary);
            box-shadow: 0 0 0 3px rgba(0, 106, 103, 0.5);
        }

        .animated-button {
            background-color: var(--tsi-primary);
            color: #FFFFFF;
            transition: background-color 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 0;
        }

        /* Captcha style for better visibility */
        #captcha-display {
             background: #FEFEFE;
             border: 2px dashed var(--tsi-primary);
             color: #262626;
        }

    </style>
</head>
<body>

<div class="login-card w-full p-8 md:p-12 bg-white rounded-xl border border-gray-200">

  <!-- Header and Logo (TSI Branding) -->
  <div class="text-center mb-6">
    <!-- Replaced SVG with image logo -->
    <img src="tsi.png" alt="TSI Logo" class="h-10 w-auto mx-auto" />
    <span class="text-3xl font-bold primary-text block mt-2">TSI Ratings</span>
  </div>

  <!-- Login Title -->
  <h1 class="text-xl font-semibold text-gray-700 text-center">Stakeholder Login</h1>
  <p class="text-gray-500 mb-8 text-center text-sm">Secure access via Email OTP.</p>

  <!-- Login Form Container -->
  <form id="login-form">

    <!-- STEP 1: Email and Captcha -->
    <div id="step-1">
      <div class="mb-6">
        <label for="email-input" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
        <input type="email" id="email-input" name="email" required
               class="input-style w-full px-4 py-2 border rounded-lg shadow-sm" placeholder="your.name@organization.com">
      </div>

      <!-- Captcha Challenge -->
      <div class="mb-8 p-4 border border-gray-300 rounded-lg bg-gray-50">
        <label class="block text-sm font-medium text-gray-700 mb-2">Security Check (Captcha)</label>
        <div class="flex items-center space-x-4">
          <div id="captcha-display" class="w-32 text-center py-2 px-4 rounded-lg text-lg font-mono tracking-wider select-none transform rotate-[-1deg] shadow-sm">
            <!-- Captcha will be injected here -->
          </div>
          <input type="text" id="captcha-input" name="captcha" required placeholder="Enter code"
                 class="input-style flex-grow px-4 py-2 border rounded-lg">
          <button type="button" onclick="generateCaptcha()" class="primary-text hover:opacity-80 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"/><path d="M21 13a9 9 0 1 1-3-7.7L21 8"/></svg>
          </button>
        </div>
      </div>

      <!-- Request OTP Button -->
      <button type="button" id="request-otp-btn" onclick="requestOTP()"
              class="animated-button w-full h-11 inline-flex items-center justify-center rounded-lg font-medium text-lg tracking-wide hover:opacity-90">
        Request OTP
      </button>
    </div>

    <!-- STEP 2: OTP Verification -->
    <div id="step-2" class="hidden">
      <p class="text-md text-gray-700 mb-4">A 6-digit code has been sent to <span id="otp-email-display" class="font-bold primary-text"></span>. Please check your inbox.</p>

      <div class="flex justify-between space-x-2 mb-6" id="otp-inputs-container">
        <!-- OTP input boxes generated by JS -->
      </div>

      <button type="submit"
              class="animated-button w-full h-11 inline-flex items-center justify-center rounded-lg font-medium text-lg tracking-wide hover:opacity-90">
        Verify & Log In
      </button>

      <div class="mt-4 text-center">
        <button type="button" onclick="requestOTP()" id="resend-otp-btn" class="primary-text hover:opacity-80 text-sm font-medium" disabled>
          Resend Code (<span id="otp-timer">30</span>s)
        </button>
      </div>

      <div class="mt-6 text-center border-t pt-4">
        <button type="button" onclick="showStep(1)" class="text-gray-500 hover:text-gray-700 text-sm font-medium">
          Change Email
        </button>
      </div>
    </div>
  </form>

  <!-- Footer Links -->
  <div class="mt-8 text-center border-t pt-4">
    <span class="text-gray-500 mr-2">New user?</span>
    <a href="registration_v2.html" class="font-semibold primary-text hover:opacity-80 transition duration-150">Register Now</a>
  </div>
</div>

<script>
        let currentCaptcha = '';
        let timerInterval;
        const correctOTP = '123456'; // Simulated correct OTP

        // --- Captcha Logic ---
        function generateCaptcha() {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            let captcha = '';
            for (let i = 0; i < 6; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            currentCaptcha = captcha;
            document.getElementById('captcha-display').textContent = captcha;
            document.getElementById('captcha-input').value = '';
        }

        // --- OTP Input Helper ---
        function setupOTPInputs() {
            const container = document.getElementById('otp-inputs-container');
            container.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.maxLength = 1;
                input.className = 'otp-input input-style';
                input.id = `otp-digit-${i}`;
                input.oninput = (e) => {
                    if (e.data && i < 5) {
                        document.getElementById(`otp-digit-${i + 1}`).focus();
                    } else if (e.data === null && i > 0) { // Backspace
                        document.getElementById(`otp-digit-${i - 1}`).focus();
                    }
                };
                container.appendChild(input);
            }
        }

        // --- Timer Logic ---
        function startTimer(duration) {
            let timer = duration;
            const resendBtn = document.getElementById('resend-otp-btn');
            const timerDisplay = document.getElementById('otp-timer');

            resendBtn.disabled = true;
            timerDisplay.textContent = duration;
            resendBtn.innerHTML = `Resend Code (<span id="otp-timer">${duration}</span>s)`;

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const currentTimerDisplay = document.getElementById('otp-timer');
                if (currentTimerDisplay) {
                     currentTimerDisplay.textContent = timer;
                }

                if (--timer < 0) {
                    clearInterval(timerInterval);
                    resendBtn.disabled = false;
                    resendBtn.innerHTML = "Resend Code";
                }
            }, 1000);
        }

        // --- Step Navigation ---
        function showStep(step) {
            document.getElementById('step-1').classList.toggle('hidden', step !== 1);
            document.getElementById('step-2').classList.toggle('hidden', step !== 2);
            // Re-generate captcha if moving back to step 1
            if (step === 1) {
                 generateCaptcha();
            }
        }

        // --- Request OTP Handler (Step 1 Submit) ---
        function requestOTP() {
            const emailInput = document.getElementById('email-input');
            const captchaInput = document.getElementById('captcha-input');

            if (!emailInput.value || !captchaInput.value) {
                // Using alert() is generally discouraged in production but fine for a hackathon demo simulation
                alert('Please fill in both email and captcha fields.');
                return;
            }

            if (captchaInput.value.toLowerCase() !== currentCaptcha.toLowerCase()) {
                alert('Captcha failed. Please try again.');
                generateCaptcha();
                return;
            }

            // SIMULATION: Assume OTP request is successful
            document.getElementById('otp-email-display').textContent = emailInput.value;
            setupOTPInputs();
            startTimer(30);
            showStep(2);
        }

        // --- Verify OTP Handler (Step 2 Submit) ---
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();

            // Collect OTP
            let enteredOTP = '';
            for (let i = 0; i < 6; i++) {
                enteredOTP += document.getElementById(`otp-digit-${i}`).value;
            }

            if (enteredOTP === correctOTP) {
                alert('Login Successful! Welcome to TSI Ratings Platform.');
                // Redirect logic would go here
            } else {
                alert('OTP Verification Failed. Please check the code and try again.');
            }
        });

        // Initialize Captcha and set up initial state
        window.onload = generateCaptcha;
    </script>
</body>
</html>
